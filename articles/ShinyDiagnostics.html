<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Shiny diagnostics • PhenotypeR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shiny diagnostics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhenotypeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Main functionality</h6></li>
    <li><a class="dropdown-item" href="../articles/PhenotypeDiagnostics.html">PhenotypeDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/PhenotypeExpectations.html">PhenotypeExpectations</a></li>
    <li><a class="dropdown-item" href="../articles/ShinyDiagnostics.html">ShinyDiagnostics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Individual functions</h6></li>
    <li><a class="dropdown-item" href="../articles/DatabaseDiagnostics.html">DatabaseDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/CodelistDiagnostics.html">CodelistDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/CohortDiagnostics.html">CohortDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/PopulationDiagnostics.html">PopulationDiagnostics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://dpa-pde-oxford.shinyapps.io/PhenotypeRShiny/">PhenotypeR shiny App</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/PhenotypeR" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Shiny diagnostics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/PhenotypeR/blob/main/vignettes/ShinyDiagnostics.Rmd" class="external-link"><code>vignettes/ShinyDiagnostics.Rmd</code></a></small>
      <div class="d-none name"><code>ShinyDiagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-run-shinydiagnostics">Introduction: Run ShinyDiagnostics<a class="anchor" aria-label="anchor" href="#introduction-run-shinydiagnostics"></a>
</h2>
<p>In the previous vignettes we have seen how to run a phenotype
diagnostics and it’s expectations. ShinyDiagnostics can help us to
visualise all the results in an interactive shiny app. See an example of
how to run it below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortConstructor/" class="external-link">CohortConstructor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/PhenotypeR/">PhenotypeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                      <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomiaDir</a></span><span class="op">(</span><span class="st">"synpuf-1k"</span>, <span class="st">"5.3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">con</span>, </span>
<span>                                cdmName <span class="op">=</span> <span class="st">"Eunomia Synpuf"</span>,</span>
<span>                                cdmSchema   <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>                                writeSchema <span class="op">=</span> <span class="st">"main"</span>, </span>
<span>                                achillesSchema <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a code lists</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"user_of_warfarin"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1310149L</span>, <span class="fl">40163554L</span><span class="op">)</span>,</span>
<span>              <span class="st">"user_of_acetaminophen"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1125315L</span>, <span class="fl">1127078L</span>, <span class="fl">1127433L</span>, <span class="fl">40229134L</span>, </span>
<span>                                          <span class="fl">40231925L</span>, <span class="fl">40162522L</span>, <span class="fl">19133768L</span><span class="op">)</span>,</span>
<span>              <span class="st">"user_of_morphine"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1110410L</span>, <span class="fl">35605858L</span>, <span class="fl">40169988L</span><span class="op">)</span>,</span>
<span>              <span class="st">"measurements_cohort"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40660437L</span>, <span class="fl">2617206L</span>, <span class="fl">4034850L</span>,  <span class="fl">2617239L</span>, </span>
<span>                                        <span class="fl">4098179L</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Instantiate cohorts with CohortConstructor</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">my_cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/CohortConstructor/reference/conceptCohort.html" class="external-link">conceptCohort</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>                               conceptSet <span class="op">=</span> <span class="va">codes</span>, </span>
<span>                               exit <span class="op">=</span> <span class="st">"event_end_date"</span>,</span>
<span>                               overlap <span class="op">=</span> <span class="st">"merge"</span>,</span>
<span>                               name <span class="op">=</span> <span class="st">"my_cohort"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run PhenotypeDiagnostics including all diagnostics</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/phenotypeDiagnostics.html">phenotypeDiagnostics</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">my_cohort</span>, survival <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate expectations</span></span>
<span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat-any.html" class="external-link">chat</a></span><span class="op">(</span><span class="st">"google_gemini"</span><span class="op">)</span></span>
<span><span class="va">expectations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortExpectations.html">getCohortExpectations</a></span><span class="op">(</span>chat <span class="op">=</span> <span class="va">chat</span>, </span>
<span>                      phenotypes <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the shiny app based on PhenotypeDiagnostics results, suppressing all </span></span>
<span><span class="co"># cell counts smaller than 2, saved in a temporary directory, and with the </span></span>
<span><span class="co"># expectations created using "gemini".</span></span>
<span><span class="fu"><a href="../reference/shinyDiagnostics.html">shinyDiagnostics</a></span><span class="op">(</span>result <span class="op">=</span> <span class="va">result</span>, minCellCount <span class="op">=</span> <span class="fl">2</span>, directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, expectations <span class="op">=</span> <span class="va">expectations</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="shiny-app-overview">Shiny App Overview<a class="anchor" aria-label="anchor" href="#shiny-app-overview"></a>
</h2>
<p>Let’s now explore the Shiny App created together! Once you’ve run the
code above, you should obtain a shiny app similar to this one: <a href="https://dpa-pde-oxford.shinyapps.io/Readme_PhenotypeR/" class="external-link">here</a>.</p>
<p>The first thing we will find when creating the PhenotypeR Shiny
Diagnostics is a <strong>Background</strong> tab with a small summary of
all the diagnostics:
<img src="ShinyDiagnosticsFigures/figure1.png" class="r-plt" alt="" width="90%"></p>
<p>You can see which PhenotypeR version was used to generate the Shiny
App by clicking the <em>i</em> tab at the top.</p>
<p><img src="ShinyDiagnosticsFigures/figure2.png" class="r-plt" alt="" width="90%"></p>
<p>Or download the summarised result by clicking the <em>download</em>
tab:</p>
<p><img src="ShinyDiagnosticsFigures/figure3.png" class="r-plt" alt="" width="90%"></p>
<p>Notice that we have a tab for each one of the diagnostics, and those
contain the specific analyses performed. Results are visualised in the
form of interactive tables and plots.</p>
<p><strong>Database Diagnostics:</strong></p>
<p><img src="ShinyDiagnosticsFigures/figure4.png" class="r-plt" alt="" width="90%"><strong>Codelist Diagnostics:</strong></p>
<p><img src="ShinyDiagnosticsFigures/figure5.png" class="r-plt" alt="" width="90%"></p>
<p><strong>Cohort Diagnostics:</strong></p>
<p><img src="ShinyDiagnosticsFigures/figure6.png" class="r-plt" alt="" width="90%"></p>
<p><strong>Population Diagnostics:</strong></p>
<p><img src="ShinyDiagnosticsFigures/figure7.png" class="r-plt" alt="" width="90%"></p>
<p>Let’s now explore additional functionalities that the
ShinyDiagnostics offers. If we click to <em>Codelist diagnostics /
Achilles code use</em> or <em>Codelist diagnostics / Orphan code
use</em> tab, we will first find a horizontal purple bar that will show
us all the databases we included:</p>
<p><img src="ShinyDiagnosticsFigures/figure8.png" class="r-plt" alt="" width="90%"></p>
<p>Once we have selected the ones of interest, we will need to click the
<strong>UPDATE</strong> button to generate the table with the
results.</p>
<p>For <strong>Codelist diagnostics / cohort code use</strong>,
<strong>Codelist diagnostics / measurement diagnostics</strong>,
<strong>Cohort diagnostics</strong> and <strong>Population
diagnostics</strong>, we will also have the option to select the cohorts
of interest:</p>
<p><img src="ShinyDiagnosticsFigures/figure9.png" class="r-plt" alt="" width="90%"></p>
<p>We will always find (in all the tabs) a <em>download</em> icon on the
left which will download the table, gt table, or plot that is being
shown:</p>
<p><img src="ShinyDiagnosticsFigures/figure10.png" class="r-plt" alt="" width="90%"></p>
<p>In some tabs, we will also find a left tab that will show additional
filtering or formatting options (remember to click
<strong>UPDATE</strong> every time you change a parameter!):</p>
<p><img src="ShinyDiagnosticsFigures/figure11.png" class="r-plt" alt="" width="90%"></p>
<p>When we have two (or more) subtabs with different formatting formats
(which is the case for <strong>Population diagnostics /
Incidence</strong>, where we have a table and a plot), the formatting
tab will be on the right:</p>
<p><img src="ShinyDiagnosticsFigures/figure12.png" class="r-plt" alt="" width="90%"></p>
<p>Now it’s your turn to explore the <a href="https://dpa-pde-oxford.shinyapps.io/Readme_PhenotypeR/" class="external-link">Shiny
App</a>!</p>
</div>
<div class="section level2">
<h2 id="special-cases">Special cases<a class="anchor" aria-label="anchor" href="#special-cases"></a>
</h2>
<p>As mentioned, <code>ShinyDiagnostics()</code> can be run with
specific diagnostic results. This includes
<code>DatabaseDiagnostics()</code>, <code>CodelistDiagnostics()</code>,
<code>CohortDiagnostics()</code>, and
<code>PopulationDiagnostics()</code>. Alternatively, you can disable
diagnostics within <code>PhenotypeDiagnostics()</code>. If a diagnostic
is not performed, its corresponding tab will not appear in the Shiny
App. Similarly, if survival analysis is skipped in
<code>CohortDiagnostics()</code>, its tab will be removed. The same
applies if your CDM lacks ACHILLES tables, which means “achilles code
use” and “orphan code use” cannot be performed. In such cases, their
tabs will also be automatically removed from the Shiny App.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Burn, Martí Català, Xihang Chen, Marta Alcalde-Herraiz, Nuria Mercade-Besora, Albert Prats-Uribe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
