<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Phenotype diagnostics â€¢ PhenotypeR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Phenotype diagnostics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhenotypeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Main functionality</h6></li>
    <li><a class="dropdown-item" href="../articles/PhenotypeDiagnostics.html">PhenotypeDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/PhenotypeExpectations.html">PhenotypeExpectations</a></li>
    <li><a class="dropdown-item" href="../articles/ShinyDiagnostics.html">ShinyDiagnostics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Individual functions</h6></li>
    <li><a class="dropdown-item" href="../articles/DatabaseDiagnostics.html">DatabaseDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/CodelistDiagnostics.html">CodelistDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/CohortDiagnostics.html">CohortDiagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/PopulationDisgnostics.html">PopulationDisgnostics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://dpa-pde-oxford.shinyapps.io/PhenotypeRShiny/">PhenotypeR shiny App</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/PhenotypeR" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Phenotype diagnostics</h1>
            
      

      <div class="d-none name"><code>PhenotypeDiagnostics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-run-phenotypediagnostics">Introduction: Run PhenotypeDiagnostics<a class="anchor" aria-label="anchor" href="#introduction-run-phenotypediagnostics"></a>
</h2>
<p>In this vignette, we are going to present how to run
<code>PhenotypeDiagnostics()</code>. We are going to use the following
packages and mock data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortConstructor/" class="external-link">CohortConstructor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/PhenotypeR/">PhenotypeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                      <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomiaDir</a></span><span class="op">(</span><span class="st">"synpuf-1k"</span>, <span class="st">"5.3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">con</span>, </span>
<span>                                cdmName <span class="op">=</span> <span class="st">"Eunomia Synpuf"</span>,</span>
<span>                                cdmSchema   <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>                                writeSchema <span class="op">=</span> <span class="st">"main"</span>, </span>
<span>                                achillesSchema <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span></code></pre></div>
<p>Note that we have included <a href="https://github.com/OHDSI/Achilles" class="external-link">achilles tables</a> in our cdm
reference, which will be used to speed up some of the analyses.</p>
</div>
<div class="section level2">
<h2 id="create-a-cohort">Create a cohort<a class="anchor" aria-label="anchor" href="#create-a-cohort"></a>
</h2>
<p>First, we are going to use the package <a href="https://ohdsi.github.io/CohortConstructor/" class="external-link">CohortConstructor</a>
to generate three cohorts of <em>warfarin</em>, <em>acetaminophen</em>
and <em>morphine</em> users.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a codelist</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"warfarin"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1310149</span>, <span class="fl">40163554</span><span class="op">)</span>,</span>
<span>              <span class="st">"acetaminophen"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1125315</span>, <span class="fl">1127078</span>, <span class="fl">1127433</span>, <span class="fl">40229134</span>, <span class="fl">40231925</span>, <span class="fl">40162522</span>, <span class="fl">19133768</span><span class="op">)</span>,</span>
<span>              <span class="st">"morphine"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1110410</span>, <span class="fl">35605858</span>, <span class="fl">40169988</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Instantiate cohorts with CohortConstructor</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">my_cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/CohortConstructor/reference/conceptCohort.html" class="external-link">conceptCohort</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>                               conceptSet <span class="op">=</span> <span class="va">codes</span>, </span>
<span>                               exit <span class="op">=</span> <span class="st">"event_end_date"</span>,</span>
<span>                               overlap <span class="op">=</span> <span class="st">"merge"</span>,</span>
<span>                               name <span class="op">=</span> <span class="st">"my_cohort"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-phenotypediagnostics">Run PhenotypeDiagnostics<a class="anchor" aria-label="anchor" href="#run-phenotypediagnostics"></a>
</h2>
<p>Now we will proceed to run <code>phenotypeDiagnotics()</code>. This
function will run the following analyses:</p>
<ul>
<li>
<strong>Database diagnostics</strong>: This includes information
about the size of the data, the time period covered, the number of
people in the data, and other meta-data of the CDM object. See <a href="https://ohdsi.github.io/PhenotypeR/articles/a03_DatabaseDiagnostics.html">Database
diagnostics vignette</a> for more details.</li>
<li>
<strong>Codelist diagnostics</strong>: This includes information on
the concepts included in our cohortsâ€™ codelist. See <a href="https://ohdsi.github.io/PhenotypeR/articles/a04_CodelistDiagnostics.html">Codelist
diagnostics vignette</a> for further details.</li>
<li>
<strong>Cohort diagnostics</strong>: This summarises the
characteristics of our cohorts, as well as comparing them to age and sex
matched controls from the database.. See <a href="https://ohdsi.github.io/PhenotypeR/articles/a05_CohortDiagnostics.html">Cohort
diagnostics vignette</a> for further details.</li>
<li>
<strong>Population diagnostics</strong>: Calculates the frequency of
our study cohorts in the database in terms of their incidence rates and
prevalence. See <a href="https://ohdsi.github.io/PhenotypeR/articles/a07_PopulationDiagnostics.html">Population
diagnostics vignette</a> for further details.</li>
</ul>
<p>We can specify which analysis we want to perform by setting to TRUE
or FALSE each one of the corresponding arguments:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">phenotypeDiagnostics</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">cohort =</span> cdm<span class="sc">$</span>my_cohort, </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">databaseDiagnostics =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">codelistDiagnostics =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">cohortDiagnostics   =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="at">match =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="at">matchedSample =</span> <span class="dv">1000</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="at">populationDiagnostics =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="at">populationSample =</span> <span class="fl">1e+06</span>,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="at">populationDateRange =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>result <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<p>Notice that we have three additional arguments:</p>
<ul>
<li>
<code>populationSample</code>: It allows to specify a number of
people that randomly will be extracted from the CDM to perform the
<strong>Population diagnostics</strong> analysis. If NULL, all the
participants in the CDM will be included. It helps to reduce the
computational time. This is particularly useful when outcomes of
interest are relatively common, but when they are rarer we may wish to
maximise statistical power and calculate estimates for the dataset as a
whole in which case we would set this argument to NULL.</li>
<li>
<code>populationDateRange</code>: We can use it to specify the time
period when we want to perform our <strong>Population
diagnostics</strong> analysis.</li>
<li>
<code>match</code>: If set to TRUE, our study cohorts will be
matched with people with similar age and sex in the database, and will
perform a large-scale characterisation on our original cohort, the
sampled cohort (those participants from our cohort that have found a
match) and the matched cohort. If set to FALSE, cohortDiagnostics will
only be performed on our original cohorts.</li>
<li>
<code>matchedSample</code>: Similar to populationSample, this
arguments subsets a random sample of people from our cohort and performs
the matched analysis on this sample. If we have very large cohorts we
can use this to save computational time.</li>
</ul>
</div>
<div class="section level2">
<h2 id="save-the-results">Save the results<a class="anchor" aria-label="anchor" href="#save-the-results"></a>
</h2>
<p>To save the results, we can use <a href="https://darwin-eu.github.io/omopgenerics/reference/exportSummarisedResult.html" class="external-link">exportSummarisedResult</a>
function from <a href="https://darwin-eu.github.io/omopgenerics/index.html" class="external-link">omopgenerics</a>
R Package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/exportSummarisedResult.html" class="external-link">exportSummarisedResult</a></span><span class="op">(</span><span class="va">result</span>, directory <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, minCellCount <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualisation-of-the-results">Visualisation of the results<a class="anchor" aria-label="anchor" href="#visualisation-of-the-results"></a>
</h2>
<p>Once we get our <strong>Phenotype diagnostics</strong> result, we can
use <code>shinyDiagnostics</code> to easily create a shiny app and
visualise our results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shinyDiagnostics.html">shinyDiagnostics</a></span><span class="op">(</span><span class="va">result</span>,</span>
<span>                           directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                           minCellCount <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                           open <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Notice that we have specified the minimum number of counts
(<code>minCellCount</code>) for suppression to be shown in the shiny
app, and also that we want the shiny to be launched in a new R session
(<code>open</code>). You can see the shiny app generated for this
example in <a href="https://dpa-pde-oxford.shinyapps.io/PhenotypeRShiny/" class="external-link">here</a>.See
<a href="https://ohdsi.github.io/PhenotypeR/articles/a02_ShinyDiagnostics.html">Shiny
diagnostics vignette</a> for a full explanation of the shiny app.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Burn, Marti Catala, Xihang Chen, Marta Alcalde-Herraiz, Albert Prats-Uribe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
